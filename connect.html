<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Let’s Connect | Associated Industries</title>

  <!-- Fonts -->
  <style>
    @font-face {
      font-family: "Qaranta";
      src: url("/assets/Qaranta-Bold.woff2") format("woff2"),
           url("/assets/Qaranta-Bold.woff") format("woff");
      font-weight: 700;
      font-style: normal;
      font-display: swap;
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">

  <!-- Styles -->
  <style>
    :root {
      --ai-blue: #0073E5;
      --ai-green: #22C55E;
      --ai-light: #E1F1FD;
      --ai-ink: #15182F;
      --ai-deep: #2F6F4E;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Open Sans", sans-serif;
      background: url("https://skyfordscissorhands.github.io/connect/web-trees&lake4.jpg") 
              no-repeat center center fixed;
    background-size: cover;
      color: var(--ai-ink);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }

    .card {
      background: var(--ai-light);
      border-radius: 24px;
      box-shadow: 0 12px 24px rgba(0, 115, 229, 0.2);
      padding: 36px;
      text-align: center;
      width: 100%;
      max-width: 460px;
      position: relative;
      overflow: hidden;
    }

    h1 {
      font-family: "Qaranta", sans-serif;
      font-weight: 700;
      color: var(--ai-blue);
      font-size: 2rem;
      margin: 0 0 8px;
    }

    p {
      margin: 0 0 18px;
      color: var(--ai-ink);
    }

    input {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border: 1px solid #cfd8e3;
      border-radius: 10px;
      font-family: "Open Sans", sans-serif;
      font-size: 15px;
      outline: none;
    }

    input:focus {
      border-color: var(--ai-blue);
      box-shadow: 0 0 0 3px rgba(0, 115, 229, 0.12);
    }

    button {
      width: 100%;
      background: var(--ai-blue);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 14px;
      margin-top: 12px;
      font-weight: 600;
      font-family: "Open Sans", sans-serif;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
    }

    button:hover {
     background: var(--ai-green);
    color: white;
    border: 2px solid var(--ai-green);
    box-shadow: 0 4px 10px rgba(34, 197, 94, 0.25);
    transform: translateY(-1px);
    transition: background 0.25s ease, transform 0.2s ease, box-shadow 0.25s ease;
    }

    .slide-up {
      transform: translateY(-110%);
      opacity: 0;
      pointer-events: none;
    }

    #saveStep {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      z-index: -1;
      transform: translateY(10%);
      transition: all 0.6s ease;
    }

    #saveStep.show {
      opacity: 1;
      transform: translateY(0);
    }

    .tick {
      background: var(--ai-green);
      color: white;
      font-weight: 700;
      font-size: 22px;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      box-shadow: 0 6px 12px rgba(34, 197, 94, 0.3);
    }

    .footer {
      margin-top: 20px;
      font-size: 13px;
      color: #555;
    }
  </style>
</head>
<body>

  <main class="card">
    <h1>Let’s Connect</h1>
    <p>Share your info below to receive our contact instantly.</p>

    <!-- Stage 1: Form -->
    <form id="connectForm"
      action="https://formspree.io/f/mvgvzlye"
      method="POST">
    <!-- FormSubmit options -->
    <input type="hidden" name="_next" value="https://associated-industries.com/">
    <input type="hidden" name="_captcha" value="false">
    <input type="hidden" name="_template" value="table">

    <input type="text" name="name" placeholder="Name" required>
    <input type="email" name="email" placeholder="Email" required>
    <input type="tel" name="phone" placeholder="Phone Number" required>
    <input type="text" name="company" placeholder="Company Name (optional)">
    <button type="submit">Connect</button>
</form>

    <!-- Stage 2: Save step -->
    <div id="saveStep" style="display:none; text-align:center; margin-top:20px;">
        <p>Thanks for connecting!</p>
        <a href="https://associated-industries.com/robert.vcf" 
           class="btn"
           download>
           Save My Contact
        </a>
    </div>

    

    <div class="footer">
      Soil & Groundwater Professionals<br>
      Associated Industries
    </div>
  </main>


<script>
  // STEP 1 — connect to your Google Sheet (public TSV export)
  const SHEET_TSV_URL =
    "https://docs.google.com/spreadsheets/d/1dUwWHORlh7et2LX69o5HklUJOG9nOkYrJjdzltbEJv4/export?format=tsv&gid=0";

  const form = document.getElementById("connectForm");

  // Helper to clean up slug text
  function normalizeSlug(s) {
    return (s || "")
      .toString()
      .trim()
      .toLowerCase()
      .replace(/\s+/g, "-");
  }

  // STEP 2 — load your sheet and build a map of slugs → vcf links
  async function loadDirectory() {
    const res = await fetch(SHEET_TSV_URL, { cache: "no-store" });
    const text = await res.text();

    const lines = text.trim().split("\n");
    const headers = lines[0].split("\t").map((h) => h.trim().toLowerCase());
    const slugIdx = headers.indexOf("slug");
    const vcfIdx =
      headers.indexOf("vcf_download_link") !== -1
        ? headers.indexOf("vcf_download_link")
        : headers.indexOf("vcf_link");

    if (slugIdx === -1 || vcfIdx === -1) {
      console.error("Sheet must include 'slug' and 'vcf_download_link' columns.");
      return {};
    }

    const directory = {};
    for (let i = 1; i < lines.length; i++) {
      const cols = lines[i].split("\t");
      const slug = normalizeSlug(cols[slugIdx]);
      const link = (cols[vcfIdx] || "").trim();
      if (slug && link) directory[slug] = link;
    }
    return directory;
  }

  // STEP 3 — handle the form submission
  function handleSubmit(vcfUrl) {
    return async function (e) {
      e.preventDefault();

      // send form to Formspree
      fetch(form.action, {
        method: "POST",
        body: new FormData(form),
        headers: { Accept: "application/json" },
      });

      // show the save contact button
      form.innerHTML = `
        <div style="text-align:center;">
          <h2>Thanks for connecting!</h2>
          <p>Save our contact below.</p>
          <a href="${vcfUrl}" class="btn" download>Save My Contact</a>
        </div>
      `;

      // redirect to homepage after 3 seconds
      setTimeout(() => {
        window.location.href = "https://associated-industries.com/";
      }, 3000);
    };
  }

  // STEP 4 — initialize everything
  (async () => {
    const directory = await loadDirectory();

    // Get ?person=slug from URL (example: ?person=robert-lopez)
    const params = new URLSearchParams(window.location.search);
    const personParam = normalizeSlug(params.get("person"));
    const fallbackSlug = Object.keys(directory)[0] || "";
    const chosenSlug = directory[personParam] ? personParam : fallbackSlug;
    const vcfUrl = directory[chosenSlug] || "";

    form.addEventListener("submit", handleSubmit(vcfUrl));
  })();
</script>


</body>
</html>

